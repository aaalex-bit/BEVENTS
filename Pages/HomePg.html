<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BEVENTS</title>
  <link rel="stylesheet" href="../Constants/Constants.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
</head>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>

</script>
<body>
  <header>
    <div class="brand">
      <img src="../Assets/logo.jpeg" alt="BEVENTS Logo" class="logo" />
      <h1 class="brand-name">BISONS EVENTS HUB</h1>
    </div>
    
      <nav class="admin-btn-div">
        <a id="admin-btn" href="./LoginPg.html">Sign Up as Admin</a>
      </nav>  
    </header>
    <section class="hero">
      <div class="hero-content">
        <h1 id="welcome-title" class="animate__animated animate__fadeInDown">
          Welcome To BEVENTS
        </h1>

        <div class="search-container">
          <input type="text" id="search-input" placeholder="Search events..." />

          <button id="search-btn">Search</button>
        </div>
      </div>
    </section>
    <section id="events-section" class="events">
      <div class="bubbles-bg" aria-hidden="true">
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
      </div>
      <h2 class="section-title">Explore Events</h2>
      <button id="refreshBtn" class="refresh-btn">Refresh Events</button>
      <div class="cards-container" id="live-events-grid">
        <!-- CARD 1 -->
        <article class="event-tile">
          <img class="event-img" src="../Assets/background.png" alt="Event 1" />
          <div class="event-details">
            <div class="date-box">
              <span class="month">FEB</span>
              <span class="day">23</span>
            </div>

            <div>
              <div class="meta-row">
                <span class="tag">Free</span>
                <span class="time">8:00 Pm – 11:00 Pm</span>
              </div>

              <h3 class="event-title">Trivia Night</h3>

              <a href="DetailPg.html" class="see-more-btn"> See More </a>
            </div>
          </div>
        </article>

        <!-- CARD 2 -->
        <article class="event-tile">
          <img class="event-img" src="../Assets/background.png" alt="Event 2" />
          <div class="event-details">
            <div class="date-box">
              <div class="month">FEB</div>
              <div class="day">24</div>
            </div>
            <div class="event-text">
              <div class="meta-row">
                <span class="tag">Free</span>
                <span class="time">8:00 pm - 11:30 pm</span>
              </div>
              <h3 class="event-title">Karaoke Night</h3>
              <button class="see-more-btn" id="see-more-2">See More</button>
            </div>
          </div>
        </article>

        <!-- CARD 3 -->
        <article class="event-tile">
          <img class="event-img" src="../Assets/background.png" alt="Event 3" />
          <div class="event-details">
            <div class="date-box">
              <div class="month">FEB</div>
              <div class="day">25</div>
            </div>
            <div class="event-text">
              <div class="meta-row">
                <span class="tag">Free</span>
                <span class="time">10:00 am - 11:00 am</span>
              </div>
              <h3 class="event-title">Office Hours</h3>
              <button class="see-more-btn" id="see-more-3">See More</button>
            </div>
          </div>
        </article>

        <!-- CARD 4 -->
        <article class="event-tile">
          <img class="event-img" src="../Assets/background.png" alt="Event 4" />
          <div class="event-details">
            <div class="date-box">
              <div class="month">MAR</div>
              <div class="day">01</div>
            </div>
            <div class="event-text">
              <div class="meta-row">
                <span class="tag">Free</span>
                <span class="time">6:00 pm - 9:00 pm</span>
              </div>
              <h3 class="event-title">Pool Night</h3>
              <button class="see-more-btn" id="see-more-4">See More</button>
            </div>
          </div>
        </article>

        <!-- CARD 5 -->
        <article class="event-tile">
          <img class="event-img" src="../Assets/background.png" alt="Event 5" />
          <div class="event-details">
            <div class="date-box">
              <div class="month">MAR</div>
              <div class="day">02</div>
            </div>
            <div class="event-text">
              <div class="meta-row">
                <span class="tag">Free</span>
                <span class="time">4:30 pm - 7:30 pm</span>
              </div>
              <h3 class="event-title">Cosmopolitan</h3>
              <button class="see-more-btn" id="see-more-5">See More</button>
            </div>
          </div>
        </article>

        <!-- CARD 6 -->
        <article class="event-tile">
          <img class="event-img" src="../Assets/background.png" alt="Event 6" />
          <div class="event-details">
            <div class="date-box">
              <div class="month">MAR</div>
              <div class="day">03</div>
            </div>
            <div class="event-text">
              <div class="meta-row">
                <span class="tag">Free</span>
                <span class="time">7:00 pm - 10:00 pm</span>
              </div>
              <h3 class="event-title">Wing Night</h3>
              <button class="see-more-btn" id="see-more-6">See More</button>
            </div>
          </div>
        </article>

        <!-- CARD 7 -->
        <article class="event-tile">
          <img class="event-img" src="../Assets/background.png" alt="Event 7" />
          <div class="event-details">
            <div class="date-box">
              <div class="month">MAR</div>
              <div class="day">04</div>
            </div>
            <div class="event-text">
              <div class="meta-row">
                <span class="tag">Free</span>
                <span class="time">3:00 pm - 6:00 pm</span>
              </div>
              <h3 class="event-title">Workshop</h3>
              <button class="see-more-btn" id="see-more-7">See More</button>
            </div>
          </div>
        </article>

        <!-- CARD 8 -->
        <article class="event-tile">
          <img class="event-img" src="../Assets/background.png" alt="Event 8" />
          <div class="event-details">
            <div class="date-box">
              <div class="month">MAR</div>
              <div class="day">05</div>
            </div>
            <div class="event-text">
              <div class="meta-row">
                <span class="tag">Free</span>
                <span class="time">5:00 pm - 8:00 pm</span>
              </div>
              <h3 class="event-title">Networking</h3>
              <button class="see-more-btn" id="see-more-8">See More</button>
            </div>
          </div>
        </article>

        <!-- CARD 9 -->
        <article class="event-tile">
          <img class="event-img" src="../Assets/background.png" alt="Event 9" />
          <div class="event-details">
            <div class="date-box">
              <div class="month">MAR</div>
              <div class="day">06</div>
            </div>
            <div class="event-text">
              <div class="meta-row">
                <span class="tag">Free</span>
                <span class="time">2:00 pm - 4:00 pm</span>
              </div>
              <h3 class="event-title">Campus Fair</h3>
              <button class="see-more-btn" id="see-more-9">See More</button>
            </div>
          </div>
        </article>
      </div>
    </section>
    <footer class="footer">
        <div class="footer-waves" aria-hidden="true">
        <div class="wave wave1"></div>
        <div class="wave wave2"></div>
        <div class="wave wave3"></div>
      </div>
      <div class="footer-container">
        <div class="footer-brand">
          <h2>BISONS EVENTS HUB</h2>
          <p>Connecting students to campus experiences.</p>
        </div>

        <div class="footer-links">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#events-section">Events</a></li>
            <li><a href="./LoginPg.html">Admin</a></li>
          </ul>
        </div>

        <div class="footer-contact">
          <h4>Contact</h4>

          <p>
            <i class="fa-solid fa-envelope"></i>
            info@bevents.ca
          </p>

          <p>
            <i class="fa-solid fa-location-dot"></i>
            Winnipeg, MB
          </p>

          <p>
            <i class="fa-solid fa-phone"></i>
            +1 (204) 123-4567
          </p>
        </div>

        <div class="footer-bottom">© 2025 BEVENTS. All rights reserved.</div>
      </div>
    </footer>

    <script>
    async function fetchAndDisplayEvents() {
        const container = document.getElementById('live-events-grid');
        
        try {
            const response = await fetch('http://localhost:3000/');
            const json = await response.json();
            
            // Use the 'data' array from your JSON response
            const events = json.data; 

            if (!events || events.length === 0) {
                container.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No events found at the moment.</p>';
                return;
            }

            container.innerHTML = ''; // Clear hardcoded cards

            // Fix: Use 'events.forEach' instead of 'data.forEach'
            events.forEach(event => {
                let displayMonth = "EVENT";
                let displayDay = "??";

                // Date Formatting Logic
                if (event.date && event.date.includes('-')) { 
                    const dateParts = new Date(event.date + "T00:00:00");
                    displayMonth = dateParts.toLocaleString('en-us', { month: 'short' }).toUpperCase();
                    displayDay = dateParts.getDate();
                } else if (event.date) { 
                    const parts = event.date.split(' ');
                    displayMonth = parts[0].toUpperCase();
                    displayDay = parts[1] || "??";
                }

                const article = document.createElement('article');
                article.className = 'event-tile';
                
                article.innerHTML = `
                    <img class="event-img" src="${event.image}" alt="${event.title}" onerror="this.src='../Assets/background.png'" />
                    <div class="event-details">
                        <div class="date-box">
                            <span class="month">${displayMonth}</span>
                            <span class="day">${displayDay}</span>
                        </div>

                        <div>
                            <div class="meta-row">
                                <span class="tag" style="background: #3f72af; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px;">${event.source}</span>
                                <span class="time">${event.start_time} – ${event.end_time}</span>
                            </div>

                            <h3 class="event-title">${event.title}</h3>

                            <a href="${event.link}" target="_blank" class="see-more-btn"> See Details </a>
                        </div>
                    </div>
                `;
                container.appendChild(article);
            });
        } catch (error) {
            console.error("Error loading events:", error);
            container.innerHTML = `<p style="grid-column: 1/-1; text-align: center; color: #112d4e;">Unable to connect to the Bison Events server. Please make sure the backend is running!</p>`;
        }
    }

    window.addEventListener('DOMContentLoaded', fetchAndDisplayEvents);

    document.getElementById('refreshBtn').addEventListener('click', () => {
        document.getElementById('live-events-grid').innerHTML = '<p style="grid-column: 1/-1; text-align: center;">Refreshing events...</p>';
        fetchAndDisplayEvents();
        
    });
    </script>

<script>

let allEvents = [];

// Helper to normalize text for searching
function normalizeText(s) {
  return (s || "").toString().toLowerCase().trim();
}

function parseEventDateTime(event) {
  // 1) Date parsing
  let eventDate;

  if (!event.date) {
    return new Date(8640000000000000); // very far future if missing
  }

  // Manual events usually: YYYY-MM-DD
  if (typeof event.date === "string" && event.date.includes("-")) {
    eventDate = new Date(event.date + "T00:00:00");
  } else {
    // Scraped events might be like "FEB 23"
    // Assume current year
    const currentYear = new Date().getFullYear();
    eventDate = new Date(`${event.date} ${currentYear}`);
  }

  if (isNaN(eventDate.getTime())) {
    return new Date(8640000000000000); // fallback if bad date
  }

  // 2) Time parsing (handles "5:00 PM", "8:00 pm", etc.)
  // default = start of day
  let hours = 0;
  let minutes = 0;

  const timeText = (event.start_time || "").toString().trim();
  const match = timeText.match(/(\d{1,2}):(\d{2})\s*(AM|PM)?/i);

  if (match) {
    hours = Number(match[1]);
    minutes = Number(match[2]);
    const ampm = match[3] ? match[3].toUpperCase() : null;

    if (ampm === "PM" && hours !== 12) hours += 12;
    if (ampm === "AM" && hours === 12) hours = 0;
  }

  eventDate.setHours(hours, minutes, 0, 0);
  return eventDate;
}

// THE CORE RENDER FUNCTION
function renderEvents(events) {
  const container = document.getElementById("live-events-grid");
  if (!container) return;

  container.innerHTML = "";

  if (!events || events.length === 0) {
    container.innerHTML = `<p style="grid-column: 1/-1; text-align: center;">No events found.</p>`;
    return;
  }

  events.forEach((event) => {
    // Standardize Date Display
    let displayMonth = "TBD";
    let displayDay = "??";
    if (event.date && event.date.includes("-")) {
      const d = new Date(event.date + "T00:00:00");
      displayMonth = d.toLocaleString("en-us", { month: "short" }).toUpperCase();
      displayDay = d.getDate();
    } else if (event.date) {
      const parts = event.date.split(" ");
      displayMonth = (parts[0] || "TBD").toUpperCase();
      displayDay = parts[1] || "??";
    }

    const timeText = event.start_time && event.end_time
        ? `${event.start_time} – ${event.end_time}`
        : event.start_time || "Time N/A";

    // Create the card
    const article = document.createElement("article");
    article.className = "event-tile";

    // IMPORTANT: We use a button that triggers viewDetails
    // We stringify the event object so it can be passed as a parameter
    const eventString = encodeURIComponent(JSON.stringify(event));

    article.innerHTML = `
      <img class="event-img" src="${event.image || "../Assets/background.png"}" 
           alt="${event.title}" onerror="this.src='../Assets/background.png'" />
      <div class="event-details">
        <div class="date-box">
          <span class="month">${displayMonth}</span>
          <span class="day">${displayDay}</span>
        </div>
        <div class="event-text">
          <div class="meta-row">
            <span class="tag">${event.source}</span>
            <span class="time">${timeText}</span>
          </div>
          <h3 class="event-title">${event.title}</h3>
          <button onclick="viewDetails('${eventString}')" class="see-more-btn">See Details</button>
        </div>
      </div>
    `;
    container.appendChild(article);
  });
}

// SAVE TO STORAGE AND MOVE TO DETAIL PAGE
function viewDetails(eventStr) {
  const eventData = JSON.parse(decodeURIComponent(eventStr));
  localStorage.setItem('selectedEvent', JSON.stringify(eventData));
  window.location.href = 'DetailPg.html';
}

// FETCH FROM SERVER
async function loadEvents() {
  const container = document.getElementById("live-events-grid");
  try {
    const res = await fetch("http://localhost:3000/");
    const json = await res.json();
    allEvents = (json.data || []).sort((a, b) => {
  return parseEventDateTime(a) - parseEventDateTime(b);
});

renderEvents(allEvents);
  } catch (error) {
    console.error("Error:", error);
    container.innerHTML = `<p>Error connecting to server.</p>`;
  }
}

// SEARCH LOGIC
function applySearch() {
  const q = normalizeText(document.getElementById("search-input")?.value);
  if (!q) { renderEvents(allEvents); return; }
  
  const filtered = allEvents.filter((ev) => {
    const haystack = [ev.title, ev.source].map(normalizeText).join(" ");
    return haystack.includes(q);
  });
  renderEvents(filtered);
}

// INITIALIZE
window.addEventListener("DOMContentLoaded", () => {
  loadEvents();
  document.getElementById("search-btn")?.addEventListener("click", applySearch);
  document.getElementById("search-input")?.addEventListener("input", applySearch);
  document.getElementById("refreshBtn")?.addEventListener("click", loadEvents);
});
  </script>
  <script>
    let profile = document.querySelector(".admin-btn-div")
    console.log(document.cookie)
    let emailValue = document.cookie.match(new RegExp('(?:^|; )' + encodeURIComponent('email') + '=([^;]*)'));
    if(!document.cookie.includes("email=;")){
      
        profile.innerHTML = '<button style= "background-color: white; color: black ;" id = "admin-btn" onclick=logOut()>log out</button><button id ="admin-btn" class="linktoPost" >Post an Event<button>';

    }

    function logOut(){
      document.cookie ="email=;"

      console.log(document.cookie)
      window.location.reload()
    }

    
    
    //handles the post event button
    document.querySelector(".linktoPost").addEventListener('click', ()=>{
      window.location.href = "PostPg.html"
    })
  </script>
  </body>
</html>
